# GCP ë°°í¬ ê°€ì´ë“œ (Docker & Cloud Build)

ì´ ë¬¸ì„œëŠ” `caffeine-tracker` í”„ë¡œì íŠ¸ë¥¼ Docker ì»¨í…Œì´ë„ˆë¡œ íŒ¨í‚¤ì§•í•˜ê³  Google Cloud Platform (GCP)ì— ë°°í¬í•˜ëŠ” ì „ì²´ ê³¼ì •ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì²˜ ë° ë°°í¬ ì „ëµ ìš”ì•½

ì´ í”„ë¡œì íŠ¸ëŠ” **Frontend(React)**ì™€ **Backend(Node.js)**ê°€ ë¶„ë¦¬ëœ êµ¬ì¡°ë¡œ, ê°ê° ë…ë¦½ì ì¸ Docker ì»¨í…Œì´ë„ˆë¡œ ë°°í¬ë©ë‹ˆë‹¤. ë°ì´í„°ëŠ” **Cloud SQL(MySQL)**ì— ì €ì¥ë©ë‹ˆë‹¤.

1.  **Frontend (Cloud Run / App Engine)**
    *   React ì•±ì„ ë¹Œë“œí•˜ì—¬ Nginxë¡œ ì •ì  íŒŒì¼ì„ ì„œë¹™í•©ë‹ˆë‹¤.
    *   ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ë©°, Backend APIì™€ í†µì‹ í•©ë‹ˆë‹¤.
2.  **Backend (Cloud Run)**
    *   Node.js Express ì„œë²„ë¡œ, REST APIë¥¼ ì œê³µí•©ë‹ˆë‹¤.
    *   Cloud SQLê³¼ ì—°ê²°ë˜ì–´ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
3.  **Database (Cloud SQL)**
    *   ê´€ë¦¬í˜• MySQL ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ì˜ ì•ˆì •ì„±ê³¼ ë°±ì—…ì„ ë³´ì¥í•©ë‹ˆë‹¤.
    *   ì´ˆê¸° ìŠ¤í‚¤ë§ˆ ë° ë°ì´í„°ëŠ” í”„ë¡œì íŠ¸ ë‚´ `Dump/` í´ë”ì˜ SQL íŒŒì¼ë“¤ì„ í†µí•´ ë§ˆì´ê·¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡° ë° ë°°í¬ ì „ëµ

í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” **ë£¨íŠ¸ ê²½ë¡œì— í”„ë¡ íŠ¸ì—”ë“œ**, **`server/` í´ë”ì— ë°±ì—”ë“œ**ê°€ ìœ„ì¹˜í•œ êµ¬ì¡°ì…ë‹ˆë‹¤. ë°°í¬ë¥¼ ìœ„í•´ í´ë”ë¥¼ êµ³ì´ `client/`ì™€ `server/`ë¡œ ë¬¼ë¦¬ì ìœ¼ë¡œ ë‚˜ëˆ„ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤. ëŒ€ì‹ , Docker ë¹Œë“œ ì‹œ ì„œë¡œ ë¶ˆí•„ìš”í•œ íŒŒì¼ì´ í¬í•¨ë˜ì§€ ì•Šë„ë¡ ì„¤ì •(`dockerignore`)í•˜ë©´ ë©ë‹ˆë‹¤.

### 1. í´ë” êµ¬ì¡° ì²˜ë¦¬
*   **Frontend:** í”„ë¡œì íŠ¸ ë£¨íŠ¸(`.` )ì—ì„œ ë¹Œë“œí•©ë‹ˆë‹¤. `.dockerignore`ì— `server/`ë¥¼ ì¶”ê°€í•˜ì—¬ ë°±ì—”ë“œ ì½”ë“œê°€ í”„ë¡ íŠ¸ì—”ë“œ ì´ë¯¸ì§€ì— ë“¤ì–´ê°€ëŠ” ê²ƒì„ ë°©ì§€í–ˆìŠµë‹ˆë‹¤.
*   **Backend:** `server/` í´ë” ë‚´ë¶€ì—ì„œ ë¹Œë“œí•©ë‹ˆë‹¤.

### 2. DB ë§ˆì´ê·¸ë ˆì´ì…˜ í¬í•¨ ì—¬ë¶€
*   **Backend ì´ë¯¸ì§€:** `server/Dockerfile`ì´ `COPY . .` ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•  ë•Œ `migrations/` í´ë”ì™€ `Dump/` í´ë”(í•„ìš”ì‹œ)ë¥¼ í•¨ê»˜ ë³µì‚¬í•©ë‹ˆë‹¤.
*   ë”°ë¼ì„œ ë°°í¬ëœ **Backend ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ëŠ” ì´ë¯¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ê°€ í¬í•¨**ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
*   ë°°í¬ í›„ `npm run migrate-all` ëª…ë ¹ì–´ë¥¼ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰í•˜ê±°ë‚˜, ë³„ë„ì˜ Jobìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ³ Docker ì»¨í…Œì´ë„ˆ êµ¬ì¡° ì´í•´í•˜ê¸°

ë°°í¬ë¥¼ ì‹œì‘í•˜ê¸° ì „ì—, ì´ í”„ë¡œì íŠ¸ê°€ ì–´ë–»ê²Œ Docker ì»¨í…Œì´ë„ˆë¡œ êµ¬ì„±ë˜ëŠ”ì§€ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” **ë‘ ê°œì˜ ë…ë¦½ì ì¸ ì»¨í…Œì´ë„ˆ**ë¡œ ë‚˜ë‰˜ì–´ ë°°í¬ë©ë‹ˆë‹¤.

### 1. í”„ë¡ íŠ¸ì—”ë“œ ì»¨í…Œì´ë„ˆ (Frontend)
*   **ì—­í• :** ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ì— React ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
*   **êµ¬ì„± (`Dockerfile`):**
    *   **Build Stage:** Node.js í™˜ê²½ì—ì„œ `npm run build`ë¥¼ ì‹¤í–‰í•˜ì—¬ React ì†ŒìŠ¤ ì½”ë“œë¥¼ ì •ì  íŒŒì¼(HTML, CSS, JS)ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    *   **Production Stage:** ê°€ë³ê³  ë¹ ë¥¸ ì›¹ ì„œë²„ì¸ **Nginx**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œëœ ì •ì  íŒŒì¼ë“¤ì„ ì‚¬ìš©ìì—ê²Œ ì œê³µ(Serving)í•©ë‹ˆë‹¤.
*   **íŠ¹ì§•:** Nginxê°€ í¬í•¨ë˜ì–´ ìˆì–´ ë³„ë„ì˜ ì›¹ ì„œë²„ ì„¤ì¹˜ ì—†ì´ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### 2. ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ (Backend)
*   **ì—­í• :** API ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ í•©ë‹ˆë‹¤.
*   **êµ¬ì„± (`server/Dockerfile`):**
    *   Node.js í™˜ê²½ì„ êµ¬ì„±í•˜ê³  í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
    *   ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ì—¬ API ìš”ì²­ì„ ëŒ€ê¸°í•©ë‹ˆë‹¤.
*   **íŠ¹ì§•:** ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† ì •ë³´ ë“± ë¯¼ê°í•œ ì„¤ì •ì€ í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…ë°›ìŠµë‹ˆë‹¤.

---

## âš ï¸ ë°°í¬ ì „ í•„ìˆ˜ í™•ì¸ ë° ìˆ˜ì • ì‚¬í•­

### 1. Nginx ì„¤ì • ìˆ˜ì • (`nginx.conf`) - **ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„!**

**ì™œ ìˆ˜ì •í•´ì•¼ í•˜ë‚˜ìš”?**
*   **ë¡œì»¬ í™˜ê²½ (Docker Compose):** í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œê°€ ê°™ì€ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ìˆì–´ì„œ `http://backend:3002`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì„œë¡œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*   **GCP ë°°í¬ í™˜ê²½ (Cloud Run):** í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œê°€ **ì™„ì „íˆ ë¶„ë¦¬ëœ ë…ë¦½ì ì¸ ì„œë¹„ìŠ¤**ë¡œ ë°°í¬ë©ë‹ˆë‹¤. ë”°ë¼ì„œ í”„ë¡ íŠ¸ì—”ë“œ ì»¨í…Œì´ë„ˆ ì•ˆì˜ NginxëŠ” `backend`ë¼ëŠ” ì´ë¦„ì´ ëˆ„êµ°ì§€ ì•Œ ìˆ˜ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

**í•´ê²° ë°©ë²• (ë‘˜ ì¤‘ í•˜ë‚˜ ì„ íƒ):**

**ë°©ë²• A: í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œì—ì„œ ì§ì ‘ í˜¸ì¶œ**
Nginxë¥¼ ê±°ì¹˜ì§€ ì•Šê³ , React ì•±(ë¸Œë¼ìš°ì €)ì´ ë°±ì—”ë“œ API ì£¼ì†Œ(`https://...run.app`)ë¡œ ì§ì ‘ ìš”ì²­ì„ ë³´ë‚´ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
1.  ë°±ì—”ë“œë¥¼ ë¨¼ì € ë°°í¬í•˜ì—¬ URLì„ ì–»ìŠµë‹ˆë‹¤.
2.  í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ì‹œ `.env` íŒŒì¼ì´ë‚˜ í™˜ê²½ ë³€ìˆ˜ë¡œ `VITE_API_URL=https://ë°±ì—”ë“œì£¼ì†Œ`ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
3.  React ì½”ë“œì—ì„œ API í˜¸ì¶œ ì‹œ ì´ URLì„ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤. (Nginxì˜ `proxy_pass` ì„¤ì •ì€ ë¬´ì‹œë¨)

**ë°©ë²• B: Nginxê°€ ì¤‘ê³„í•˜ë„ë¡ ìˆ˜ì •**
ê¸°ì¡´ì²˜ëŸ¼ `/api` ìš”ì²­ì„ Nginxê°€ ë°›ì•„ì„œ ë°±ì—”ë“œë¡œ ë„˜ê²¨ì£¼ë ¤ë©´, `nginx.conf`ì˜ `proxy_pass` ì£¼ì†Œë¥¼ ì‹¤ì œ ë°±ì—”ë“œ ë°°í¬ ì£¼ì†Œë¡œ ë°”ê¿”ì•¼ í•©ë‹ˆë‹¤.
*   ìˆ˜ì • ì „: `proxy_pass http://backend:3002;`
*   ìˆ˜ì • í›„: `proxy_pass https://caffeine-backend-xyz.run.app;` (ë°±ì—”ë“œ ë°°í¬ í›„ ìƒì„±ëœ ì‹¤ì œ ì£¼ì†Œ)

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° (Cloud SQL)
ë¡œì»¬ì—ì„œëŠ” `docker-compose`ì˜ `db` ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ë°°í¬ í™˜ê²½ì—ì„œëŠ” **Cloud SQL**ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

*   **Cloud SQL ì¸ìŠ¤í„´ìŠ¤ ìƒì„±:** GCP ì½˜ì†”ì—ì„œ MySQL ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
*   **í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (`DB_HOST` ì„¤ì • ì¤‘ìš”):** ë°±ì—”ë“œ ë°°í¬ ì‹œ í™˜ê²½ì— ë”°ë¼ `DB_HOST`ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

    **A. Cloud Runì—ì„œ ë°°í¬ ì‹œ (ê¶Œì¥)**
    Cloud Runì€ Cloud SQL ì¸ìŠ¤í„´ìŠ¤ì™€ Unix Socketì„ í†µí•´ ì—°ê²°í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•˜ê³  ì¼ë°˜ì ì…ë‹ˆë‹¤.
    *   `DB_HOST`: `/cloudsql/[PROJECT_ID]:[REGION]:[INSTANCE_NAME]` (ì˜ˆ: `/cloudsql/my-project:asia-northeast3:caffeine-db`)
        *   *ì£¼ì˜: Node.js `mysql2` ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ì‹œ `socketPath` ì˜µì…˜ìœ¼ë¡œ ì²˜ë¦¬ë˜ê±°ë‚˜, í˜¸ìŠ¤íŠ¸ê°€ `/`ë¡œ ì‹œì‘í•˜ë©´ ìë™ìœ¼ë¡œ ì†Œì¼“ ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤.*
    *   `DB_USER`: DB ì‚¬ìš©ì ì´ë¦„
    *   `DB_PASSWORD`: DB ë¹„ë°€ë²ˆí˜¸
    *   `DB_NAME`: ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„
    *   **Cloud Run ë°°í¬ ëª…ë ¹ì–´ ì¶”ê°€ ì˜µì…˜:** `--add-cloudsql-instances [PROJECT_ID]:[REGION]:[INSTANCE_NAME]`

    **B. ë¡œì»¬ ê°œë°œ ë˜ëŠ” VMì—ì„œ ì ‘ì† ì‹œ**
    *   `DB_HOST`: Cloud SQL ì¸ìŠ¤í„´ìŠ¤ì˜ **Public IP** ì£¼ì†Œ (ìŠ¹ì¸ëœ ë„¤íŠ¸ì›Œí¬ ì„¤ì • í•„ìš”) ë˜ëŠ” **Cloud SQL Auth Proxy** ì‚¬ìš© ì‹œ `127.0.0.1`
    *   `DB_USER`, `DB_PASSWORD`, `DB_NAME`ì€ ë™ì¼í•˜ê²Œ ì„¤ì •

### 3. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ (í•„ìˆ˜)
ë°°í¬ ì „ ë˜ëŠ” ë°°í¬ ì§í›„ì— Cloud SQL ë°ì´í„°ë² ì´ìŠ¤ì— í…Œì´ë¸”ê³¼ ì´ˆê¸° ë°ì´í„°ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. í”„ë¡œì íŠ¸ì—ëŠ” ì´ë¯¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

**ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ë°©ë²• (ë¡œì»¬ì—ì„œ ì‹¤í–‰ ê¶Œì¥):**
1.  **Cloud SQL Auth Proxy**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œì»¬ í¬íŠ¸(ì˜ˆ: 3306)ë¥¼ Cloud SQL ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°í•©ë‹ˆë‹¤.
2.  `server/.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  Cloud SQL ì ‘ì† ì •ë³´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    ```env
    DB_HOST=127.0.0.1
    DB_USER=[DB_USER]
    DB_PASSWORD=[DB_PASSWORD]
    DB_NAME=[DB_NAME]
    ```
3.  `server` ë””ë ‰í† ë¦¬ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ `Dump/` í´ë”ì˜ ëª¨ë“  SQL íŒŒì¼ì„ DBì— ì ìš©í•©ë‹ˆë‹¤.
    ```bash
    cd server
    npm install
    npm run migrate-all
    ```
    *   ì´ ìŠ¤í¬ë¦½íŠ¸(`migrations/run-all-migrations.mjs`)ëŠ” `Dump/` í´ë”ì˜ SQL íŒŒì¼ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ í…Œì´ë¸” ìƒì„± ë° ì´ˆê¸° ë°ì´í„°ë¥¼ ì ì¬í•©ë‹ˆë‹¤.

### 4. CORS ì„¤ì • (`server/src/index.ts`)
ë°±ì—”ë“œ ì„œë²„ì˜ `cors` ì„¤ì •ì— ë°°í¬ëœ í”„ë¡ íŠ¸ì—”ë“œ ë„ë©”ì¸ì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.
```typescript
app.use(cors({
  origin: ["https://your-frontend-domain.com", "http://localhost:3000"],
  credentials: true
}));
```

## ğŸ’» ëª…ë ¹ì–´ ì‹¤í–‰ í™˜ê²½ (Windows ì‚¬ìš©ì í•„ë…)

ì´ ê°€ì´ë“œì˜ ëª¨ë“  ëª…ë ¹ì–´ëŠ” **Linux/Mac (Bash)** í™˜ê²½ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜ˆ: ì¤„ë°”ê¿ˆ ë¬¸ì `\`)
Windows ì‚¬ìš©ìëŠ” ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ ë°©ë²•ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

1.  **WSL (Windows Subsystem for Linux) ì‚¬ìš© (ê¶Œì¥):**
    *   Windowsì—ì„œ Linux í™˜ê²½ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
    *   `gcloud` CLIì™€ `Docker`ë¥¼ WSL ë‚´ë¶€ì— ì„¤ì¹˜í•˜ê±°ë‚˜, Docker Desktopì˜ WSL 2 í†µí•©ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•˜ì„¸ìš”.
2.  **GCP Cloud Shell ì‚¬ìš© (ê°€ì¥ ê°„í¸):**
    *   GCP ì½˜ì†” ì›¹ì‚¬ì´íŠ¸ ìƒë‹¨ì—ì„œ í„°ë¯¸ë„ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.
    *   ë³„ë„ì˜ ì„¤ì¹˜ ì—†ì´ `gcloud`, `docker`, `git` ë“±ì´ ëª¨ë‘ ì„¤ì¹˜ëœ Linux í™˜ê²½ì„ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3.  **PowerShell ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­:**
    *   ëª…ë ¹ì–´ì˜ ì¤„ë°”ê¿ˆ ë¬¸ì `\`ë¥¼ ë°±í‹±(`` ` ``)ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
    *   í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ë°©ì‹ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆ: `export VAR=val` -> `$env:VAR="val"`)

---

## ğŸš€ ë°°í¬ ë°©ë²• (Cloud Build & Cloud Run)

ì´ ê°€ì´ë“œëŠ” **Cloud Build**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³ , **Cloud Run**ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•˜ëŠ” ë°©ì‹ì„ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.

### 1ë‹¨ê³„: GCP í”„ë¡œì íŠ¸ ì„¤ì •
1.  [Google Cloud Console](https://console.cloud.google.com/)ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
2.  **Cloud Build API**ì™€ **Cloud Run API**ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.
3.  `gcloud` CLIê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. (`gcloud auth login`, `gcloud config set project [PROJECT_ID]`)

### 2ë‹¨ê³„: Cloud Buildë¡œ ì´ë¯¸ì§€ ë¹Œë“œ
í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìˆëŠ” `cloudbuild.yaml` íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  Container Registry(GCR)ì— í‘¸ì‹œí•©ë‹ˆë‹¤.

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰
gcloud builds submit --config cloudbuild.yaml .
```
*ì„±ê³µ ì‹œ `gcr.io/[PROJECT_ID]/caffeine-server`ì™€ `gcr.io/[PROJECT_ID]/caffeine-web` ì´ë¯¸ì§€ê°€ ìƒì„±ë©ë‹ˆë‹¤.*

### 3ë‹¨ê³„: ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ë°°í¬ (Cloud Run)
ë¨¼ì € ë°±ì—”ë“œë¥¼ ë°°í¬í•˜ì—¬ API URLì„ í™•ë³´í•©ë‹ˆë‹¤.

```bash
gcloud run deploy caffeine-backend \
  --image gcr.io/[PROJECT_ID]/caffeine-server \
  --platform managed \
  --region asia-northeast3 \
  --allow-unauthenticated \
  --set-env-vars DB_HOST=[CLOUD_SQL_IP],DB_USER=[USER],DB_PASSWORD=[PASS],DB_NAME=[DB_NAME]
```
*   `--allow-unauthenticated`: ì™¸ë¶€ì—ì„œ API ì ‘ì†ì„ í—ˆìš©í•©ë‹ˆë‹¤.
*   `--set-env-vars`: DB ì ‘ì† ì •ë³´ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤. (ë³´ì•ˆì„ ìœ„í•´ Secret Manager ì‚¬ìš© ê¶Œì¥)

### 4ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ ë°°í¬ (Cloud Run)
ë°±ì—”ë“œ ë°°í¬ê°€ ì™„ë£Œë˜ë©´, í”„ë¡ íŠ¸ì—”ë“œë¥¼ ë°°í¬í•©ë‹ˆë‹¤.

**ì£¼ì˜:** í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë°±ì—”ë“œ APIë¥¼ í˜¸ì¶œí•  ë•Œ ì‚¬ìš©í•  URLì„ ë¹Œë“œ ì‹œì ì— ì£¼ì…í•´ì•¼ í•œë‹¤ë©´, `Dockerfile`ì´ë‚˜ ë¹Œë“œ ê³¼ì •ì„ ìˆ˜ì •í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ViteëŠ” ë¹Œë“œ ì‹œì ì— í™˜ê²½ ë³€ìˆ˜ê°€ ê³ ì •ë¨)

```bash
gcloud run deploy caffeine-frontend \
  --image gcr.io/[PROJECT_ID]/caffeine-web \
  --platform managed \
  --region asia-northeast3 \
  --allow-unauthenticated
```

---

## ğŸ“‚ íŒŒì¼ ì„¤ëª…
*   **`cloudbuild.yaml`**: Cloud Buildë¥¼ ìœ„í•œ ì„¤ì • íŒŒì¼ì…ë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ë¹Œë“œí•©ë‹ˆë‹¤.
*   **`app.yaml`**: (ì˜µì…˜) App Engine Flexible Environment ë°°í¬ ì‹œ ì‚¬ìš©ë˜ëŠ” ì„¤ì • íŒŒì¼ì…ë‹ˆë‹¤. Cloud Runì„ ì‚¬ìš©í•  ê²½ìš° í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
*   **`Dockerfile` (Root)**: í”„ë¡ íŠ¸ì—”ë“œ(React + Nginx) ë¹Œë“œìš©ì…ë‹ˆë‹¤.
*   **`server/Dockerfile`**: ë°±ì—”ë“œ(Node.js) ë¹Œë“œìš©ì…ë‹ˆë‹¤.
